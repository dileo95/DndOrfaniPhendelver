<div class="header">
  <div class="header-left"></div>
  <div style="position: absolute; left: 0px; top: 0px; width: 100%; height: 40px; background: transparent">
    <h1 style="line-height: 40px; text-align: center; margin: 0; font-size: 30px;">
      â³ Timeline degli Eventi
    </h1>
  </div>
  <div class="header-right"></div>
  <button class="back" style="position: absolute;" (click)="goBack()">
    <img src="./assets/img/back-arrow.png" style="width: 20px; margin-top: 10px;" alt="Back" />
  </button>
</div>

<div class="timeline-container" style="padding-top: 60px;">
  <header class="timeline-header">
    <h1>â³ Timeline degli Eventi</h1>
    <p class="subtitle">La cronologia completa della campagna Phendelver</p>
  </header>

  <div class="timeline-controls">
    @for (arc of storyArcs; track arc.id) {
      <button 
        [class.active]="activeFilter() === arc.id"
        [style.--arc-color]="arc.color"
        (click)="filterBy(arc.id)"
        class="filter-btn">
        {{ arc.label }}
      </button>
    }
  </div>

  <div class="timeline-stats">
    <div class="stat">
      <span class="stat-value">{{ getFilteredEvents().length }}</span>
      <span class="stat-label">Eventi</span>
    </div>
    <div class="stat">
      <span class="stat-value">1490-1513</span>
      <span class="stat-label">DR</span>
    </div>
  </div>

  <div class="timeline-wrapper">
    <svg #timelineSvg class="timeline-svg"></svg>
  </div>

  <div class="timeline-legend">
    <div class="legend-item">
      <span class="marker" style="background: #fb923c;"></span> Dragon Busters
    </div>
    <div class="legend-item">
      <span class="marker" style="background: #c084fc;"></span> Prismeer
    </div>
    <div class="legend-item">
      <span class="marker" style="background: #60a5fa;"></span> Backstory Asriel
    </div>
    <div class="legend-item">
      <span class="marker" style="background: #4ade80;"></span> Storia Attuale
    </div>
  </div>

  @if (selectedEvent(); as event) {
    <div class="event-details-overlay" (click)="closeDetails()">
      <div class="event-details" (click)="$event.stopPropagation()">
        <button class="close-btn" (click)="closeDetails()">âœ•</button>
        
        <div class="event-arc" [style.background]="getEventColor(event)">
          {{ getEventIcon(event) }} {{ getArcLabel(event) }}
        </div>
        
        <div class="event-date">{{ event.date }}</div>
        <h2>{{ event.title }}</h2>
        
        @if (event.image) {
          <div class="event-image">
            <img [src]="event.image" [alt]="event.title" />
          </div>
        }
        
        <p class="event-description">{{ event.description }}</p>
        
        @if (event.entities && event.entities.length > 0) {
          <div class="event-entities">
            <h3>ğŸ­ Personaggi Coinvolti:</h3>
            <div class="entity-tags">
              @for (entity of event.entities; track entity) {
                <span class="entity-tag">{{ entity }}</span>
              }
            </div>
          </div>
        }
        
        @if (event.location) {
          <div class="event-location">
            <strong>ğŸ“ Luogo:</strong> {{ event.location }}
          </div>
        }
      </div>
    </div>
  }

  <div class="timeline-instructions">
    <p>ğŸ’¡ Click su un evento per vedere tutti i dettagli â€¢ Usa i filtri per esplorare le diverse saghe</p>
  </div>
</div>
