<div class="header">
  <div class="header-left"></div>
  <div style="position: absolute; left: 0px; top: 0px; width: 100%; height: 40px; background: transparent">
    <h1 style="line-height: 40px; text-align: center; margin: 0; font-size: 30px;">
      ğŸ—ºï¸ Mappa Personaggi & Eventi
    </h1>
  </div>
  <div class="header-right"></div>
  <button class="back" style="position: absolute;" (click)="goBack()">
    <img src="assets/img/back-arrow.png" style="width: 20px; margin-top: 10px;" alt="Back" />
  </button>
</div>

<div class="map-container" style="padding-top: 60px;">
  <header class="map-header">
    <h1>ğŸ—ºï¸ Mappa Personaggi & Eventi</h1>
    <p class="subtitle">Grafo interattivo delle relazioni nella storia</p>
  </header>

  <div class="map-controls">
    <button 
      [class.active]="activeFilter() === 'all'" 
      (click)="filterBy('all')"
      class="filter-btn">
      Tutti
    </button>
    <button 
      [class.active]="activeFilter() === 'character'" 
      (click)="filterBy('character')"
      class="filter-btn character">
      ğŸ§‘ Personaggi
    </button>
    <button 
      [class.active]="activeFilter() === 'location'" 
      (click)="filterBy('location')"
      class="filter-btn location">
      ğŸ“ Luoghi
    </button>
    <button 
      [class.active]="activeFilter() === 'event'" 
      (click)="filterBy('event')"
      class="filter-btn event">
      âš”ï¸ Eventi
    </button>
    <button 
      [class.active]="activeFilter() === 'organization'" 
      (click)="filterBy('organization')"
      class="filter-btn organization">
      ğŸ›ï¸ Organizzazioni
    </button>
  </div>

  <div class="map-wrapper">
    <svg #mapSvg class="story-graph"></svg>
  </div>

  <div class="map-legend">
    <div class="legend-item">
      <span class="node character"></span> Personaggi
    </div>
    <div class="legend-item">
      <span class="node location"></span> Luoghi
    </div>
    <div class="legend-item">
      <span class="node event"></span> Eventi
    </div>
    <div class="legend-item">
      <span class="node organization"></span> Organizzazioni
    </div>
  </div>

  @if (selectedNode(); as node) {
    <div class="node-details-overlay" (click)="closeDetails()">
      <div class="node-details" (click)="$event.stopPropagation()">
        <button class="close-btn" (click)="closeDetails()">âœ•</button>
        <h2>{{ getNodeTypeIcon(node.type) }} {{ node.name }}</h2>
        <p class="node-type">{{ node.type | titlecase }}</p>
        <p class="node-description">{{ node.description }}</p>
        <p class="node-chapter">
          <strong>Capitolo:</strong> {{ node.chapter === 'previous' ? 'Antefatti' : 'Storia' }}
        </p>
      </div>
    </div>
  }

  <div class="map-instructions">
    <p>ğŸ’¡ Trascina i nodi per esplorarli â€¢ Click per vedere i dettagli</p>
  </div>
</div>
